var canvasWidth=innerWidth;var canvasHeight=innerHeight;var score=0;var lives=3;var canvas=document.getElementById("gameCanvas");canvas.width=canvasWidth;canvas.height=canvasHeight;var ctx=canvas.getContext("2d");const PHASE_DOWNLOADING=1;const PHASE_READY=2;const PHASE_STARTING=3;const PHASE_PLAY=4;const PHASE_PAUSE=5;const PHASE_GAMEOVER=6;var cur_phase=PHASE_DOWNLOADING;var progress=0;ctx.lineWidth=8;ctx.strokeStyle="#aaa";ctx.fillStyle="#aaa";function drawProgress(){ctx.clearRect(0,0,canvasWidth,canvasHeight);var c=-Math.PI/2;var b=c+progress*Math.PI/50;ctx.beginPath();ctx.arc(canvasWidth/2,canvasHeight/2,60,c,b);ctx.stroke();var a=progress+"%";ctx.font="40px SimHei";var d=ctx.measureText(a).width;ctx.fillText(a,canvasWidth/2-d/2,canvasHeight/2+15);if(progress>=100){cur_phase=PHASE_READY;sky=new Sky(imgBackground);startEngine()}}var imgBackground=new Image();var imgBullet1=new Image();var imgsEnemy1=[new Image(),new Image(),new Image(),new Image(),new Image()];var imgsEnemy2=[new Image(),new Image(),new Image(),new Image(),new Image()];var imgsEnemy3=[new Image(),new Image(),new Image(),new Image(),new Image(),new Image(),new Image(),new Image(),new Image()];var imgsGameLoading=[new Image(),new Image(),new Image(),new Image()];var imgGamePause=new Image();var imgsHero=[new Image(),new Image(),new Image(),new Image(),new Image(),new Image()];var imgStart=new Image();downloadResource();function downloadResource(){imgBackground.src="img/background.png";imgBackground.onload=function(){progress+=4;drawProgress()};imgBullet1.src="img/bullet1.png";imgBullet1.onload=function(){progress+=3;drawProgress()};imgsEnemy1[0].src="img/enemy1.png";imgsEnemy1[0].onload=function(){progress+=3;drawProgress()};imgsEnemy1[1].src="img/enemy2_down1.png";imgsEnemy1[1].onload=function(){progress+=3;drawProgress()};imgsEnemy1[2].src="img/enemy1_down2.png";imgsEnemy1[2].onload=function(){progress+=3;drawProgress()};imgsEnemy1[3].src="img/enemy1_down3.png";imgsEnemy1[3].onload=function(){progress+=3;drawProgress()};imgsEnemy1[4].src="img/enemy1_down4.png";imgsEnemy1[4].onload=function(){progress+=3;drawProgress()};imgsEnemy2[0].src="img/enemy2.png";imgsEnemy2[0].onload=function(){progress+=3;drawProgress()};imgsEnemy2[1].src="img/enemy2_down1.png";imgsEnemy2[1].onload=function(){progress+=3;drawProgress()};imgsEnemy2[2].src="img/enemy2_down2.png";imgsEnemy2[2].onload=function(){progress+=3;drawProgress()};imgsEnemy2[3].src="img/enemy2_down3.png";imgsEnemy2[3].onload=function(){progress+=3;drawProgress()};imgsEnemy2[4].src="img/enemy2_down4.png";imgsEnemy2[4].onload=function(){progress+=3;drawProgress()};imgsEnemy3[0].src="img/enemy3_n1.png";imgsEnemy3[0].onload=function(){progress+=3;drawProgress()};imgsEnemy3[1].src="img/enemy3_n2.png";imgsEnemy3[1].onload=function(){progress+=3;drawProgress()};imgsEnemy3[2].src="img/enemy3_hit.png";imgsEnemy3[2].onload=function(){progress+=3;drawProgress()};imgsEnemy3[3].src="img/enemy3_down1.png";imgsEnemy3[3].onload=function(){progress+=3;drawProgress()};imgsEnemy3[4].src="img/enemy3_down2.png";imgsEnemy3[4].onload=function(){progress+=3;drawProgress()};imgsEnemy3[5].src="img/enemy3_down3.png";imgsEnemy3[5].onload=function(){progress+=3;drawProgress()};imgsEnemy3[6].src="img/enemy3_down4.png";imgsEnemy3[6].onload=function(){progress+=3;drawProgress()};imgsEnemy3[7].src="img/enemy3_down5.png";imgsEnemy3[7].onload=function(){progress+=3;drawProgress()};imgsEnemy3[8].src="img/enemy3_down6.png";imgsEnemy3[8].onload=function(){progress+=3;drawProgress()};imgsGameLoading[0].src="img/game_loading1.png";imgsGameLoading[0].onload=function(){progress+=3;drawProgress()};imgsGameLoading[1].src="img/game_loading2.png";imgsGameLoading[1].onload=function(){progress+=3;drawProgress()};imgsGameLoading[2].src="img/game_loading3.png";imgsGameLoading[2].onload=function(){progress+=3;drawProgress()};imgsGameLoading[3].src="img/game_loading4.png";imgsGameLoading[3].onload=function(){progress+=3;drawProgress()};imgGamePause.src="img/game_pause_nor.png";imgGamePause.onload=function(){progress+=3;drawProgress()};imgsHero[0].src="img/hero1.png";imgsHero[0].onload=function(){progress+=3;drawProgress()};imgsHero[1].src="img/hero2.png";imgsHero[1].onload=function(){progress+=3;drawProgress()};imgsHero[2].src="img/hero_blowup_n1.png";imgsHero[2].onload=function(){progress+=3;drawProgress()};imgsHero[3].src="img/hero_blowup_n2.png";imgsHero[3].onload=function(){progress+=3;drawProgress()};imgsHero[4].src="img/hero_blowup_n3.png";imgsHero[4].onload=function(){progress+=3;drawProgress()};imgsHero[5].src="img/hero_blowup_n4.png";imgsHero[5].onload=function(){progress+=3;drawProgress()};imgStart.src="img/start.png";imgStart.onload=function(){progress+=3;drawProgress()}}var sky=null;function Sky(a){this.x1=0;this.y1=0;this.x2=0;this.y2=-a.height;this.draw=function(){ctx.drawImage(a,this.x1,this.y1,innerWidth,innerHeight);ctx.drawImage(a,this.x2,this.y2,innerWidth,innerHeight)};this.move=function(){this.y1++;this.y2++;if(this.y1>=canvasHeight){this.y1=this.y2-a.height}if(this.y2>=canvasHeight){this.y2=this.y1-a.height}}}function drawLogo(){ctx.drawImage(imgStart,canvasWidth/2-imgStart.width/2,canvasHeight/2-imgStart.height/2)}canvas.addEventListener("click",function(){if(cur_phase===PHASE_READY){cur_phase=PHASE_STARTING;runningPlane=new RunningPlane(imgsGameLoading)}},false);var runningPlane=null;function RunningPlane(a){this.x=0;this.y=canvasHeight-a[0].height;this.index=0;this.draw=function(){ctx.drawImage(a[this.index],this.x,this.y)};this.moveCount=0;this.move=function(){this.moveCount++;if(this.moveCount%5===0){this.index++;if(this.index===a.length){cur_phase=PHASE_PLAY;hero=new Hero(imgsHero);bulletList=new BulletList();enemyList=new EnemyList()}}}}var hero=null;function Hero(a){this.width=a[0].width;this.height=a[0].height;this.x=canvasWidth/2-a[0].width/2;this.y=canvasHeight-a[0].height;this.index=0;this.crashed=false;this.moveCount=0;this.draw=function(){ctx.drawImage(a[this.index],this.x,this.y)};this.move=function(){if(!this.crashed){if(this.index===0){this.index=1}else{this.index=0}}this.moveCount++;if(this.moveCount%3==0){var b=new Bullet(imgBullet1);bulletList.add(b)}if(this.crashed&&this.moveCount%2===0){if(this.index===0||this.index===1){this.index=2}else{this.index++;if(this.index===a.length-1){lives--;if(lives>0){this.x=canvasWidth/2-this.width/2;this.y=canvasHeight-this.height;this.index=0;this.crashed=false}else{cur_phase=PHASE_GAMEOVER}}}}};canvas.addEventListener("mousemove",function(c){var b=c.offsetX-a[0].width/2;var d=c.offsetY-a[0].height/2;this.x=b;this.y=d}.bind(this),false)}function Bullet(a){this.width=a.width;this.height=a.height;this.x=hero.x+(imgsHero[0].width/2-a.width/2);this.y=hero.y-a.height;this.removable=false;this.draw=function(){ctx.drawImage(a,this.x,this.y)};this.move=function(){this.y-=a.height;if(this.y<=-a.height){this.removable=true}}}var bulletList=null;function BulletList(){this.list=[];this.add=function(a){this.list.push(a)};this.draw=function(){for(var a=0;a<this.list.length;a++){this.list[a].draw()}};this.move=function(){for(var a=0;a<this.list.length;a++){this.list[a].move();if(this.list[a].removable){this.list.splice(a,1);a--}}}}var enemyList=null;function Enemy1(a){this.width=a[0].width;this.height=a[0].height;this.x=Math.random()*(canvasWidth-this.width);this.y=-this.height;this.index=0;this.blood=1;this.removable=false;this.score=10;this.crashed=false;this.moveCount=0;this.draw=function(){ctx.drawImage(a[this.index],this.x,this.y)};this.move=function(){this.y+=10;if(this.y>=canvasHeight){this.removable=true}this.moveCount++;if(this.crashed&&this.moveCount%3==0){this.index++;if(this.index===a.length-1){this.removable=true}}}}function Enemy2(a){this.width=a[0].width;this.height=a[0].height;this.x=Math.random()*(canvasWidth-this.width);this.y=-this.height;this.index=0;this.blood=4;this.removable=false;this.score=50;this.crashed=false;this.moveCount=0;this.draw=function(){ctx.drawImage(a[this.index],this.x,this.y)};this.move=function(){this.y+=5;if(this.y>=canvasHeight){this.removable=true}this.moveCount++;if(this.crashed&&this.moveCount%3==0){this.index++;if(this.index===a.length-1){this.removable=true}}}}function Enemy3(a){this.width=a[0].width;this.height=a[0].height;this.x=Math.random()*(canvasWidth-this.width);this.y=-this.height;this.index=0;this.blood=10;this.removable=false;this.score=150;this.crashed=false;this.moveCount=0;this.draw=function(){ctx.drawImage(a[this.index],this.x,this.y)};this.move=function(){0;this.y+=3;if(this.y>=canvasHeight){this.removable=true}if(!this.crashed){if(this.index==0){this.index=1}else{if(this.index===1){this.index=0}else{if(this.index==0||this.index===1){this.index==3}else{this.index++}if(this.index===a.length-1){this.removable=true}}}}this.moveCount++;if(this.crashed&&this.moveCount%3==0){this.index++;if(this.index===a.length-1){this.removable=true}}}}var enemyList=null;function EnemyList(){this.list=[];this.add=function(a){this.list.push(a)};this.draw=function(){for(var a=0;a<this.list.length;a++){this.list[a].draw()}};this.move=function(){var d=Math.floor(Math.random()*200);if(d<6){this.add(new Enemy1(imgsEnemy1))}else{if(d<9){this.add(new Enemy2(imgsEnemy2))}else{if(d<10){this.add(new Enemy3(imgsEnemy3))}}}for(var f=0;f<this.list.length;f++){var b=this.list[f];for(var c=0;c<bulletList.list.length;c++){var a=bulletList.list[c];if(b.x+b.width>=a.x&&a.x+a.width>=b.x&&b.y+b.height>=a.y&&a.y+a.height>=b.y){a.removable=true;b.blood--;if(b.blood<=0){b.crashed=true;score+=b.score}}}}for(var f=0;f<this.list.length;f++){var b=this.list[f];if(b.x+b.width>=hero.x&&hero.x+hero.width>=b.x&&b.y+b.height>=hero.y&&hero.y+hero.height>=b.y){b.blood--;if(b.blood<=0){b.crashed=true}hero.crashed=true}}for(var f=0;f<this.list.length;f++){var g=this.list[f];g.move();if(g.removable){this.list.splice(f,1);f--}}}}function drawStat(){ctx.font="20px Simhei";ctx.fillStyle="#333";var c="SCORE:"+score;ctx.fillText(c,5,25);var b="LIVES:"+lives;var a=ctx.measureText(b).width;ctx.fillText(b,canvasWidth-a-5,25)}canvas.addEventListener("mouseout",function(){if(cur_phase===PHASE_PLAY){cur_phase=PHASE_PAUSE}},false);canvas.addEventListener("mouseover",function(){if(cur_phase===PHASE_PAUSE){cur_phase=PHASE_PLAY}},false);function drawPause(){ctx.drawImage(imgGamePause,canvasWidth/2-imgGamePause.width/2,canvasHeight/2-imgGamePause.height/2)}function drawGameOver(){ctx.font="60px Simhei";var a="GAME OVER";var b=ctx.measureText(a).width;ctx.fillText(a,canvasWidth/2-b/2,canvasHeight/2)}function startEngine(){setInterval(function(){sky.draw();sky.move();switch(cur_phase){case PHASE_READY:drawLogo();break;case PHASE_STARTING:runningPlane.draw();runningPlane.move();break;case PHASE_PLAY:hero.draw();hero.move();bulletList.draw();bulletList.move();enemyList.draw();enemyList.move();drawStat();break;case PHASE_PAUSE:drawPause();break;case PHASE_GAMEOVER:drawGameOver();break}},42)};